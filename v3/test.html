<!DOCTYPE html>
<!-- saved from url=(0045)http://bayou.pvos.org/data/pe7ng4kztt2n/ach/0 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>bayou.pvos.org</title><link rel="stylesheet" href="./test_files/style.css"><!--script(src='https://cdn.jsdelivr.net/npm/chart.js@2.8.0')--><!--script(src='js/dist/Char.min.js')--><script src="./test_files/luxon.min.js"></script><script src="./test_files/chart.js@2.9.3"></script><script src="./test_files/regression.min.js"></script><!--script(src='https://cdn.jsdelivr.net/npm/luxon@1.22.1')--><script src="./test_files/chartjs-adapter-luxon@0.2.1"></script><script src="./test_files/qrcode.min.js"></script><script src="js/bayou.js"></script><style type="text/css">/* Chart.js */
@keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}</style></head><body>
    <div></div>
    <input type="file" id="fileinput" />

    <div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div>
    
    <script>var co2_ambient = 400;
</script><script>function updateBaseline() {
//console.log("poo");
//co2_ambient =co2_ambient+100;
//console.log(co2_ambient);
console.log(document.getElementById("new_baseline").value);
co2_ambient=parseInt(document.getElementById("new_baseline").value);
//console.log(co2_ambient);
document.getElementById("baseline").innerHTML = co2_ambient.toString();
}
</script>

<hr>

<p class="boxsmaller">Select region of graph below to perform exponential fit:</p><canvas id="overlay" width="537" height="179" style="position:absolute;pointer-events:none;"></canvas><canvas id="myChart" width="671" height="223" style="display: block; width: 671px; height: 223px;" class="chartjs-render-monitor"></canvas>

<hr>

<p class="boxsmaller" id="fitval"><b>ACH</b>:</p>

<canvas id="exponential" width="300" height="100"></canvas>

<hr>

<p class="boxsmaller">Plot and Fit of <b>ln[(co2-co2_ambient)/co2[t=0]-co2_ambient)]</b></p>

<p class="boxsmaller" id="linear">  <b>slope</b>; <b>intercept</b>; <b>R2</b></p>

<canvas id="myFit" width="300" height="100"></canvas>
    
    <script>var ctx = document.getElementById('myChart').getContext('2d');
ctx.canvas.width  = 300;
ctx.canvas.height = 100;
ctx = document.getElementById('overlay').getContext('2d');
ctx.canvas.width  = 300;
ctx.canvas.height = 100;
ctx = document.getElementById('exponential').getContext('2d');
ctx.canvas.width  = 300;
ctx.canvas.height = 100;
ctx = document.getElementById('myFit').getContext('2d');
ctx.canvas.width  = 300;
ctx.canvas.height = 100;
</script><script>QRCode.toCanvas(document.getElementById('qrcode'), 'http://bayou.pvos.org/data/pe7ng4kztt2n', function (error) {
if (error) console.error(error)
console.log('success!');
})
</script><script>const canvas = document.getElementById("qrcode");
const canvasdata = canvas.toDataURL();
const link = document.getElementById("downloadlink");
link.href = canvasdata;
link.download = "feed_pe7ng4kztt2n.png";
</script>
<script>//var co2_ambient = 400;
//makeNodeChart('myChart',"pe7ng4kztt2n","co2_ppm",2000,"0",co2_ambient);
//setupOverlay('myChart');//makeFit('myFit',"pe7ng4kztt2n","co2_ppm",2000,"0",co2_ambient);</script>

<script>
    function csvJSON(csv){
  
  var lines=csv.split("\n");
  
  var result = [];
  
  // NOTE: If your columns contain commas in their values, you'll need
  // to deal with those before doing the next step 
  // (you might convert them to &&& or something, then covert them back later)
  // jsfiddle showing the issue https://jsfiddle.net/
  //var headers=lines[0].split(",");
  var headers =["Time","CO2","Temp","Humid","Press"];
  for(var i=1;i<lines.length-1;i++){
  
      var obj = {};
      var currentline=lines[i].split(",");
  
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = currentline[j];
      }
  
      result.push(obj);
  
  }
  //console.log(result);
  
  return result; //JavaScript object
  //return JSON.stringify(result); //JSON
  
  }
  </script>
  
  <script>
    function readSingleFile(evt) {
      var f = evt.target.files[0]; 
      if (f) {
  
  
        var r = new FileReader();
        
        r.onload = function(e) { 
            var contents = e.target.result;
            //document.write("File Uploaded! <br />" + "name: " + f.name + "<br />" + "content: " + contents + "<br />" + "type: " + f.type + "<br />" + "size: " + f.size + " bytes <br />");
  
            // try the parser:
            var p = csvJSON(contents);
            //console.log(p);
            var in_json = csvJSON(contents);
  
            var feed_pubkey = "2323";
            var plot_param = "co2";
            var limit = 100;
            var node_id=0;
            var co2_ambient = 412;
  
            var co2_vs_time = [];
  
            for (var i =0; i<p.length;i++) {
              var thisItem = p[i];
              var co2StrDouble = thisItem['CO2'];
              var timeutc = thisItem['Time'];
              var co2Str = co2StrDouble.replace(/['"]+/g, '');
                //console.log(parseInt(co2Str));
                var co2 = parseInt(co2Str);
  
                var luxtime = luxon.DateTime.fromFormat(timeutc, "M/d/yyyy h:mm:ss a");
  
                //console.log(luxtime.toString());
    
                co2_vs_time.push({"t":luxtime,"y":co2})
              }
  
            makeNodeChart('myChart',co2_vs_time,co2_ambient);
  
       }
        r.readAsText(f);
        //document.write(output);
      } else { 
        alert("Failed to load file");
      }
    }
    document.getElementById('fileinput').addEventListener('change', readSingleFile);
  </script>


</body></html>